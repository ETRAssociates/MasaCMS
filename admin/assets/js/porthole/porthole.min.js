!function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.PortholeClass=function(){},PortholeClass.extend=function(n){var i=this.prototype;e=!0;var r=new this;for(var o in e=!1,n)r[o]="function"==typeof n[o]&&"function"==typeof i[o]&&t.test(n[o])?function(e,t){return function(){var n=this._super;this._super=i[e];var r=t.apply(this,arguments);return this._super=n,r}}(o,n[o]):n[o];function s(){!e&&this.init&&this.init.apply(this,arguments)}return s.prototype=r,s.prototype.constructor=s,s.extend=arguments.callee,s}}(),function(e){"use strict";var t={debug:!1,trace:function(t){this.debug&&void 0!==e.console&&e.console.log("Porthole: "+t)},error:function(t){void 0!==typeof e.console&&"function"==typeof e.console.error&&e.console.error("Porthole: "+t)},WindowProxy:function(){}};t.WindowProxy.prototype={post:function(e,t){},addEventListener:function(e){},removeEventListener:function(e){}},t.WindowProxyBase=PortholeClass.extend({init:function(t){void 0===t&&(t=""),this.targetWindowName=t,this.origin=e.location.protocol+"//"+e.location.host,this.eventListeners=[]},getTargetWindowName:function(){return this.targetWindowName},getOrigin:function(){return this.origin},getTargetWindow:function(){return t.WindowProxy.getTargetWindow(this.targetWindowName)},post:function(t,n){void 0===n&&(n="*"),this.dispatchMessage({data:t,sourceOrigin:this.getOrigin(),targetOrigin:n,sourceWindowName:e.name,targetWindowName:this.getTargetWindowName()})},addEventListener:function(e){return this.eventListeners.push(e),e},removeEventListener:function(e){var t;try{t=this.eventListeners.indexOf(e),this.eventListeners.splice(t,1)}catch(e){this.eventListeners=[]}},dispatchEvent:function(e){var n;for(n=0;n<this.eventListeners.length;n++)try{this.eventListeners[n](e)}catch(e){t.error(e)}}}),t.WindowProxyLegacy=t.WindowProxyBase.extend({init:function(e,n){this._super(n),null!==e?(this.proxyIFrameName=this.targetWindowName+"ProxyIFrame",this.proxyIFrameLocation=e,this.proxyIFrameElement=this.createIFrameProxy()):(this.proxyIFrameElement=null,t.trace("proxyIFrameUrl is null, window will be a receiver only"),this.post=function(){throw new Error("Receiver only window")})},createIFrameProxy:function(){var e=document.createElement("iframe");return e.setAttribute("id",this.proxyIFrameName),e.setAttribute("name",this.proxyIFrameName),e.setAttribute("src",this.proxyIFrameLocation),e.setAttribute("frameBorder","1"),e.setAttribute("scrolling","auto"),e.setAttribute("width",30),e.setAttribute("height",30),e.setAttribute("style","position: absolute; left: -100px; top:0px;"),e.style.setAttribute&&e.style.setAttribute("cssText","position: absolute; left: -100px; top:0px;"),document.body.appendChild(e),e},dispatchMessage:function(n){var i=e.encodeURIComponent;if(this.proxyIFrameElement){var r=this.proxyIFrameLocation+"#"+i(t.WindowProxy.serialize(n));this.proxyIFrameElement.setAttribute("src",r),this.proxyIFrameElement.height=this.proxyIFrameElement.height>50?50:100}}}),t.WindowProxyHTML5=t.WindowProxyBase.extend({init:function(e,t){this._super(t),this.eventListenerCallback=null},dispatchMessage:function(e){this.getTargetWindow().postMessage(t.WindowProxy.serialize(e),e.targetOrigin)},addEventListener:function(t){if(0===this.eventListeners.length){var n=this;e.addEventListener?(this.eventListenerCallback=function(e){n.eventListener(n,e)},e.addEventListener("message",this.eventListenerCallback,!1)):e.attachEvent&&(this.eventListenerCallback=function(t){n.eventListener(n,e.event)},e.attachEvent("onmessage",this.eventListenerCallback))}return this._super(t)},removeEventListener:function(t){this._super(t),0===this.eventListeners.length&&(e.removeEventListener?e.removeEventListener("message",this.eventListenerCallback):e.detachEvent&&(void 0===e.onmessage&&(e.onmessage=null),e.detachEvent("onmessage",this.eventListenerCallback)),this.eventListenerCallback=null)},eventListener:function(e,n){var i=t.WindowProxy.unserialize(n.data);!i||""!==e.targetWindowName&&i.sourceWindowName!=e.targetWindowName||e.dispatchEvent(new t.MessageEvent(i.data,n.origin,e))}}),e.postMessage?(t.trace("Using built-in browser support"),t.WindowProxy=t.WindowProxyHTML5.extend({})):(t.trace("Using legacy browser support"),t.WindowProxy=t.WindowProxyLegacy.extend({})),t.WindowProxy.serialize=function(e){if("undefined"==typeof JSON)throw new Error("Porthole serialization depends on JSON!");return JSON.stringify(e)},t.WindowProxy.unserialize=function(e){if("undefined"==typeof JSON)throw new Error("Porthole unserialization dependens on JSON!");try{var t=JSON.parse(e)}catch(e){return!1}return t},t.WindowProxy.getTargetWindow=function(t){return""===t?parent:"top"===t||"parent"===t?e[t]:e.frames[t]},t.MessageEvent=function(e,t,n){this.data=e,this.origin=t,this.source=n},t.WindowProxyDispatcher={forwardMessageEvent:function(n){var i,r,o,s=e.decodeURIComponent;document.location.hash.length>0&&(i=t.WindowProxy.unserialize(s(document.location.hash.substr(1))),r=t.WindowProxy.getTargetWindow(i.targetWindowName),(o=t.WindowProxyDispatcher.findWindowProxyObjectInWindow(r,i.sourceWindowName))?o.origin===i.targetOrigin||"*"===i.targetOrigin?o.dispatchEvent(new t.MessageEvent(i.data,i.sourceOrigin,o)):t.error("Target origin "+o.origin+" does not match desired target of "+i.targetOrigin):t.error("Could not find window proxy object on the target window"))},findWindowProxyObjectInWindow:function(e,t){var n;if(e)for(n in e)if(Object.prototype.hasOwnProperty.call(e,n))try{if(null!==e[n]&&"object"==typeof e[n]&&e[n]instanceof e.Porthole.WindowProxy&&e[n].getTargetWindowName()===t)return e[n]}catch(e){}return null},start:function(){e.addEventListener?e.addEventListener("resize",t.WindowProxyDispatcher.forwardMessageEvent,!1):e.attachEvent&&"undefined"!==e.postMessage?e.attachEvent("onresize",t.WindowProxyDispatcher.forwardMessageEvent):document.body.attachEvent?e.attachEvent("onresize",t.WindowProxyDispatcher.forwardMessageEvent):t.error("Cannot attach resize event")}},void 0!==e.exports?e.exports.Porthole=t:e.Porthole=t}(this);